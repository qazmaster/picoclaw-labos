---
name: systematic-debugging
description: "Системный дебаггинг: причина → гипотеза → тест → фикс. Используй при любом баге, падении теста, неожиданном поведении. Триггеры: 'дебаг', 'почему падает', 'не работает', 'ошибка', 'bug'."
---

# Systematic Debugging

## Обзор

Случайные фиксы тратят время и создают новые баги. Быстрые патчи маскируют проблемы.

**Принцип:** ВСЕГДА находи root cause ПЕРЕД фиксом. Фикс симптома = провал.

## Iron Law

```
НЕТ ФИКСОВ БЕЗ ROOT CAUSE INVESTIGATION
```

Если не прошёл Phase 1, нельзя предлагать фиксы.

## Четыре фазы

### Phase 1: Root Cause Investigation

**ПЕРЕД любым фиксом:**

1. **Читай сообщения об ошибках внимательно**
   - Не пропускай ошибки и warnings
   - Читай stack traces полностью
   - Записывай номера строк, пути файлов

2. **Воспроизведи стабильно**
   - Можешь вызвать надёжно?
   - Какие точные шаги?
   - Каждый раз или иногда?

3. **Проверь недавние изменения**
   - Что изменилось?
   - Git diff, коммиты
   - Новые зависимости, конфиг

4. **Собери evidence в multi-component системах**

   ```
   Для КАЖДОЙ границы компонентов:
     - Логируй что входит
     - Логируй что выходит
     - Проверяй environment/config propagation
   ```

5. **Trace Data Flow**
   - Откуда плохое значение?
   - Кто вызвал с плохим значением?
   - Продолжай вверх до источника
   - Фикси источник, не симптом

### Phase 2: Pattern Analysis

1. **Найди рабочие примеры**
   - Похожий работающий код в том же codebase?

2. **Сравни с reference**
   - Прочитай reference ПОЛНОСТЬЮ
   - Понимай pattern прежде чем применять

3. **Идентифицируй различия**
   - Что отличается?
   - Не предполагай "это не важно"

### Phase 3: Hypothesis and Testing

1. **Сформулируй гипотезу**
   - "Я думаю X — root cause потому что Y"
   - Запиши

2. **Тестируй минимально**
   - МИНИМАЛЬНОЕ изменение для проверки
   - Одна переменная за раз

3. **Verify перед продолжением**
   - Сработало? → Phase 4
   - Не сработало? → НОВАЯ гипотеза

### Phase 4: Implementation

1. **Создай failing test case**
   - Простейшее воспроизведение
   - ОБЯЗАТЕЛЬНО перед фиксом

2. **Один фикс**
   - Адресуй root cause
   - ОДНО изменение
   - Никаких "пока тут"

3. **Verify fix**
   - Тест проходит?
   - Другие не сломались?

4. **Если 3+ фикса не сработали**
   - **СТОП**
   - Это архитектурная проблема
   - Обсуди с человеком

## Red Flags — СТОП

- "Quick fix на время"
- "Просто попробую изменить X"
- "Несколько изменений сразу"
- "Пропущу тест, проверю вручную"
- "Наверное X, пофиксю"
- "Ещё одна попытка" (после 2+ неудач)

**Все эти = СТОП. Вернись к Phase 1.**

## Связанные скиллы

- `test-driven-development` → failing test для фикса
- `deep-research` → исследование проблемы
- `dispatching-parallel-agents` → параллельный дебаг независимых проблем
